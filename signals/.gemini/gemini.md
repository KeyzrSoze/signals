# Project Signals: Pharmacy Price Spike Early Warning System (EWS)

## üéØ Project Goal
To predict sudden price spikes (>10%) in pharmaceutical drugs (NADAC) 8 weeks in advance using an "Event Sourcing" architecture. The system prioritizes **Accuracy** and **Zero Data Leakage** above all else.

## üõ†Ô∏è Core Tech Stack (Current Standards)
*These are the established defaults. Deviate only with significant justification.*
- **Language:** Python 3.12 (Conda env: `signals`)
- **Data Engine:** Polars (Preferred for ETL speed & type safety)
- **Modeling:** XGBoost (Current Baseline for Spike Probability)
- **Architecture:** Domain-Driven Design (`src/ingestion`, `src/features`, `src/models`)

## üìÇ Project Structure (Do Not Deviate)
- `src/ingestion/`: Scrapers for NADAC, FDA Shortages, and NDC Directory.
- `src/entities/`: Logic for the **Entity Map** (Bridge between NDC <-> Ingredient <-> Manufacturer).
- `src/features/`: Signal generation using **Point-in-Time (As-Of) Joins**.
- `src/models/`: Training logic & artifacts.
- `src/reporting/`: Client-facing CSV/Dashboard generation.

## ü§ñ AI Instructions (Rules of the Road)
1.  **Polars First:** Use `polars` for data manipulation pipelines to maintain speed. Use `pandas` only for compatibility with ML libraries (e.g., Scikit-Learn/XGBoost) that require it.
2.  **The "Time Machine" Rule:** Feature Engineering **MUST** use `join_asof` logic. Never merge "future" shortage data onto "past" price rows.
3.  **Entity Mapping:** Never assume an NDC string is enough. Always link NDCs to the `ndc_entity_map.parquet` to resolve Ingredients and Manufacturers.
4.  **Financial Context:** Code comments must explain the *market impact* (e.g., "Calculating HHI to detect monopoly pricing power") not just the math.
5.  **Innovation Clause:** You are encouraged to recommend architectural upgrades (e.g., Moving from XGBoost to LSTM/Transformers, or adding Vector Databases). However, **do not implement** these changes without first explaining the "Why" and the expected ROI (Return on Investment) to the user.

## üîî Core Logic (Existing Features)
- **Market HHI:** Monopoly detection (Herfindahl-Hirschman Index).
- **Price Velocity:** 4-week momentum calculation.
- **Shortage Integration:** "Kitchen Sink" logic linking FDA events to NADAC prices via fuzzy text matching.
- **Risk Score:** A probability (0-1) generated by the Model.

## üöÄ Feature Roadmap (Next Steps)
1.  **Client Narratives:** Automated text generation explaining *why* a drug is high risk (e.g., "Risk High due to monopoly supplier entering shortage").
2.  **Visualizations:** Plotly dashboards showing price history overlaid with shortage events.
3.  **Slide Deck Generator:** Automated PowerPoint creation for the "Top 50 Watchlist."